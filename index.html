<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤æ—¥ç‰©è¯­ï¼šä¸å¥¹çš„ç›¸é‡</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
        }

        h1 {
            font-size: 2.5rem;
            color: #00ffcc;
            text-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
            margin-bottom: 10px;
        }

        .subtitle {
            color: #aaa;
            font-size: 1.1rem;
        }

        /* é€‰æ‹©ç•Œé¢æ ·å¼ */
        #selectionScreen {
            display: block;
        }

        .character-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .character-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .character-card:hover {
            transform: translateY(-5px);
            border-color: #00ffcc;
            box-shadow: 0 5px 20px rgba(0, 255, 204, 0.3);
        }

        .character-card.selected {
            border-color: #00ffcc;
            background: rgba(0, 255, 204, 0.1);
        }

        .character-card img {
            width: 100%;
            /* height: 430px; */
            object-fit: cover;
        }

        .character-info {
            padding: 15px;
            text-align: center;
        }

        .character-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .character-desc {
            color: #aaa;
            font-size: 0.9rem;
        }

        /* åœºæ™¯ç•Œé¢æ ·å¼ */
        #gameScreen {
            display: none;
        }

        .scene-container {
            position: relative;
            width: 100%;
            height: 500px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .scene-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.8s ease;
        }

        .scene-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
            padding: 20px;
        }

        .scene-title {
            font-size: 1.2rem;
            color: #00ffcc;
            margin-bottom: 10px;
        }

        /* å¯¹è¯æ¡†æ ·å¼ */
        .dialogue-box {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #00ffcc;
        }

        .character-display {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .character-avatar {
            /* width: 60px;
            height: 60px;
            border-radius: 50%; */
            object-fit: cover;
            border: 3px solid #00ffcc;
            margin-right: 15px;

            width: 150px;
            height: 300px;
            position: absolute;
            top: -335px;
            right: 0;
        }

        .character-name-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ffcc;
        }

        .dialogue-text {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 25px;
            min-height: 60px;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            background: linear-gradient(45deg, #00ffcc, #00cc99);
            color: #000;
            border: none;
            padding: 12px 40px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 0 auto;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 255, 204, 0.4);
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #666;
            color: #fff;
            margin-top: 10px;
        }

        .btn-start {
            margin-top: 30px;
        }

        .hidden {
            display: none;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .character-selection {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .scene-container {
                height: 300px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .dialogue-text {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .character-selection {
                grid-template-columns: 1fr;
            }
            
            .scene-container {
                height: 200px;
            }
            
            .dialogue-box {
                padding: 15px;
            }
        }

        /* ç‰ˆæƒä¿¡æ¯ */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #aaa;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer p {
            margin: 5px 0;
        }

        /* æ—‹è½¬éŸ³ç¬¦å®¹å™¨ */
        .music-notes-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .music-note {
            position: absolute;
            font-size: 40px;
            color: #00ffcc;
            text-shadow: 0 0 10px rgba(0, 255, 204, 0.8);
            opacity: 0.8;
            transition: transform 0.1s linear;
        }

        /* éŸ³ä¹æ§åˆ¶æŒ‰é’®æ ·å¼ */
        .music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .music-btn {
            background: linear-gradient(45deg, #00ffcc, #00cc99);
            color: #000;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
        }

        .music-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 255, 204, 0.4);
        }

        /* .music-btn.playing {
            background: linear-gradient(45deg, #ff6600, #ff3300);
        } */

        /* æ—‹è½¬åŠ¨ç”» */
        @keyframes rotateMusic {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        /* æ’­æ”¾çŠ¶æ€ï¼šæŒç»­æ—‹è½¬ */
        .music-btn.playing {
            animation: rotateMusic 2s linear infinite;
        }

        /* éŸ³é‡æ§åˆ¶ */
        .volume-control {
            position: absolute;
            bottom: 60px;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 10px;
            display: none;
        }

        .volume-control.show {
            display: block;
        }

        .volume-slider {
            width: 100px;
            -webkit-appearance: none;
            height: 6px;
            background: #666;
            border-radius: 3px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00ffcc;
            cursor: pointer;
        }

        /* éŸ³ä¹æç¤º */
        .music-notice {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            display: none;
            z-index: 1000;
        }

        .music-notice.show {
            display: block;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            20%, 80% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        
        <!-- é€‰æ‹©ç•Œé¢ -->
        <div id="selectionScreen">
            <header>
                <h1>å¤æ—¥ç‰©è¯­ï¼šä¸å¥¹çš„ç›¸é‡</h1>
                <p class="subtitle">è¯·é€‰æ‹©ä¸€ä¸ªè§’è‰²å¼€å§‹ä½ çš„æ•…äº‹</p>
            </header>

            <div class="character-selection">
                <div class="character-card" data-id="1">
                    <img src="1.png" alt="è“å‘å°‘å¥³" onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg width=\"100%\" height=\"100%\" viewBox=\"0 0 200 300\" xmlns=\"http://www.w3.org/2000/svg\"><rect width=\"100%\" height=\"100%\" fill=\"#3498db\"/></svg>
                    <div class="character-info">
                        <div class="character-name">è“å‘å°‘å¥³</div>
                        <div class="character-desc">æ¸©æŸ”æ–‡é™ï¼Œå–œæ¬¢ç»˜ç”»å’Œé˜…è¯»</div>
                    </div>
                </div>

                <div class="character-card" data-id="2">
                    <img src="2.png" alt="ç»¿å‘å°‘å¥³" onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg width=\"100%\" height=\"100%\" viewBox=\"0 0 200 300\" xmlns=\"http://www.w3.org/2000/svg\"><rect width=\"100%\" height=\"100%\" fill=\"#2ecc71\"/></svg>
                    <div class="character-info">
                        <div class="character-name">ç»¿å‘å°‘å¥³</div>
                        <div class="character-desc">ç¥ç§˜ä¼˜é›…ï¼Œå–œæ¬¢æ˜Ÿç©ºå’ŒéŸ³ä¹</div>
                    </div>
                </div>

                <div class="character-card" data-id="3">
                    <img src="3.png" alt="é“¶å‘å°‘å¥³" onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg width=\"100%\" height=\"100%\" viewBox=\"0 0 200 300\" xmlns=\"http://www.w3.org/2000/svg\"><rect width=\"100%\" height=\"100%\" fill=\"#95a5a6\"/></svg>
                    <div class="character-info">
                        <div class="character-name">é“¶å‘å°‘å¥³</div>
                        <div class="character-desc">æ´»æ³¼å¼€æœ—ï¼Œå–œæ¬¢æˆ·å¤–æ´»åŠ¨</div>
                    </div>
                </div>

                <div class="character-card" data-id="4">
                    <img src="4.png" alt="ç´«å‘å°‘å¥³" onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg width=\"100%\" height=\"100%\" viewBox=\"0 0 200 300\" xmlns=\"http://www.w3.org/2000/svg\"><rect width=\"100%\" height=\"100%\" fill=\"#9b59b6\"/></svg>
                    <div class="character-info">
                        <div class="character-name">ç´«å‘å°‘å¥³</div>
                        <div class="character-desc">æµªæ¼«æ¢¦å¹»ï¼Œå–œæ¬¢æ¸¸ä¹å›­å’Œç”œç‚¹</div>
                    </div>
                </div>
            </div>

            <button id="startButton" class="btn btn-start">å¼€å§‹æ•…äº‹</button>
        </div>

        <!-- æ¸¸æˆç•Œé¢ -->
        <div id="gameScreen">
            <div class="scene-container">
                <img id="sceneImage" class="scene-image" src="" alt="åœºæ™¯å›¾ç‰‡">
                <div class="scene-overlay">
                    <div id="sceneTitle" class="scene-title"></div>
                </div>
            </div>

            <div class="dialogue-box">
                <div class="character-display">
                    <img id="dialogueAvatar" class="character-avatar" src="" alt="è§’è‰²å¤´åƒ">
                    <div id="dialogueName" class="character-name-display"></div>
                </div>
                
                <div id="dialogueText" class="dialogue-text">
                    ç‚¹å‡»"å¼€å§‹å¯¹è¯"æŒ‰é’®ç»§ç»­æ•…äº‹...
                </div>
                
                <div class="button-group">
                    <button id="nextButton" class="btn">å¼€å§‹å¯¹è¯</button>
                    <button id="restartButton" class="btn btn-secondary hidden">é‡æ–°å¼€å§‹</button>
                </div>
            </div>
        </div>
        <footer class="footer">
            <p>Â© 2026 å¤æ—¥ç‰©è¯­ï¼šä¸å¥¹çš„ç›¸é‡</p>
            <p>ç‰ˆæƒå½’å±äººï¼šæ±ªå…‰å®‡ / æ¨å¸†</p>
            <p>All Rights Reserved.</p>
        </footer>

        <!-- éŸ³ä¹æ§åˆ¶ç•Œé¢ -->
        <div class="music-control">
            <div class="volume-control" id="volumeControl">
                <input type="range" min="0" max="1" step="0.1" value="0.5" class="volume-slider" id="volumeSlider">
            </div>
            <div class="music-btn" id="musicToggle" title="èƒŒæ™¯éŸ³ä¹æ§åˆ¶">
                â™ª
            </div>
            <!-- <button class="music-btn" id="musicToggle" title="èƒŒæ™¯éŸ³ä¹æ§åˆ¶">
                â™ª
            </button> -->
        </div>
        <audio id="bgm" loop preload="auto">
            <source src="bgm.mp3" type="audio/mpeg">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
        </audio>

    <script>
        // éŸ³ä¹æ§åˆ¶ç³»ç»Ÿ
        class MusicController {
            constructor() {
                this.audio = document.getElementById('bgm');
                this.musicToggle = document.getElementById('musicToggle');
                this.volumeSlider = document.getElementById('volumeSlider');
                this.volumeControl = document.getElementById('volumeControl');
                this.musicNotice = document.getElementById('musicNotice');
                this.isPlaying = false;
                this.volume = 0.5; // é»˜è®¤éŸ³é‡50%
                
                this.init();
            }
            
            init() {
                // è®¾ç½®åˆå§‹éŸ³é‡
                this.audio.volume = this.volume;
                this.volumeSlider.value = this.volume;
                
                // ç»‘å®šäº‹ä»¶
                this.musicToggle.addEventListener('click', () => this.toggleMusic());
                this.volumeSlider.addEventListener('input', (e) => this.setVolume(e.target.value));
                this.musicToggle.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.toggleVolumeControl();
                });
                
                // é¡µé¢ç‚¹å‡»éšè—éŸ³é‡æ§åˆ¶
                document.addEventListener('click', (e) => {
                    if (!this.volumeControl.contains(e.target) && e.target !== this.musicToggle) {
                        this.volumeControl.classList.remove('show');
                    }
                });
                
                // å°è¯•è‡ªåŠ¨æ’­æ”¾
                this.attemptAutoPlay();
            }
            
            attemptAutoPlay() {
                const playPromise = this.audio.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        this.isPlaying = true;
                        this.musicToggle.classList.add('playing');
                        this.showNotice('èƒŒæ™¯éŸ³ä¹å·²å¼€å§‹æ’­æ”¾');
                    }).catch(error => {
                        console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’');
                        this.isPlaying = false;
                        this.musicToggle.classList.remove('playing');
                    });
                }
            }
            
            toggleMusic() {
                if (this.isPlaying) {
                    this.pauseMusic();
                } else {
                    this.playMusic();
                }
            }
            
            playMusic() {
                this.audio.play().then(() => {
                    this.isPlaying = true;
                    this.musicToggle.classList.add('playing');
                    this.showNotice('èƒŒæ™¯éŸ³ä¹å·²å¼€å§‹æ’­æ”¾');
                }).catch(error => {
                    console.log('æ’­æ”¾å¤±è´¥:', error);
                });
            }
            
            pauseMusic() {
                this.audio.pause();
                this.isPlaying = false;
                this.musicToggle.classList.remove('playing');
                this.showNotice('èƒŒæ™¯éŸ³ä¹å·²æš‚åœ');
            }
            
            setVolume(value) {
                this.volume = parseFloat(value);
                this.audio.volume = this.volume;
                
                // å¦‚æœé™éŸ³äº†ï¼Œåœæ­¢æ’­æ”¾
                if (this.volume === 0 && this.isPlaying) {
                    this.pauseMusic();
                } else if (this.volume > 0 && !this.isPlaying) {
                    this.playMusic();
                }
            }
            
            toggleVolumeControl() {
                this.volumeControl.classList.toggle('show');
            }
            
            showNotice(message) {
                // this.musicNotice.textContent = message;
                // this.musicNotice.classList.add('show');
                
                // setTimeout(() => {
                //     this.musicNotice.classList.remove('show');
                // }, 2000);
            }
            
            // æ·»åŠ éŸ³ä¹æ§åˆ¶åˆ°ç°æœ‰è„šæœ¬ä¸­
            static integrateWithGame() {
                window.addEventListener('DOMContentLoaded', () => {
                    const musicController = new MusicController();
                    
                    // åœ¨æ•…äº‹å¼€å§‹æ—¶è°ƒæ•´éŸ³ä¹
                    document.getElementById('startButton')?.addEventListener('click', () => {
                        if (musicController.isPlaying) {
                            musicController.audio.volume = 0.3; // é™ä½èƒŒæ™¯éŸ³ä¹éŸ³é‡
                        }
                    });
                    
                    // æ•…äº‹ç»“æŸæ—¶æ¢å¤éŸ³ä¹éŸ³é‡
                    const originalShowEnding = window.showEnding;
                    if (originalShowEnding) {
                        window.showEnding = function() {
                            originalShowEnding.apply(this, arguments);
                            if (musicController.isPlaying) {
                                musicController.audio.volume = 0.5; // æ¢å¤èƒŒæ™¯éŸ³ä¹éŸ³é‡
                            }
                        };
                    }
                    
                    // ä¿å­˜æ§åˆ¶å™¨å¼•ç”¨
                    window.musicController = musicController;
                });
            }
        }

        // åˆå§‹åŒ–éŸ³ä¹æ§åˆ¶ç³»ç»Ÿ
        MusicController.integrateWithGame();

        // å‰§æƒ…æ•°æ®
        const storyData = {
            characters: {
                1: { 
                    name: "è“å‘å°‘å¥³", 
                    img: "1.png",
                    description: "æ¸©æŸ”æ–‡é™ï¼Œå–œæ¬¢ç»˜ç”»å’Œé˜…è¯»"
                },
                2: { 
                    name: "é“¶å‘å°‘å¥³", 
                    img: "2.png",
                    description: "æ´»æ³¼å¼€æœ—ï¼Œå–œæ¬¢æˆ·å¤–æ´»åŠ¨"
                },
                3: { 
                    name: "ç»¿å‘å°‘å¥³", 
                    img: "3.png",
                    description: "ç¥ç§˜ä¼˜é›…ï¼Œå–œæ¬¢æ˜Ÿç©ºå’ŒéŸ³ä¹"
                },
                4: { 
                    name: "ç´«å‘å°‘å¥³", 
                    img: "4.png",
                    description: "æµªæ¼«æ¢¦å¹»ï¼Œå–œæ¬¢æ¸¸ä¹å›­å’Œç”œç‚¹"
                }
            },

            scenes: {
                home: { 
                    img: "åœºæ™¯1.jpg", 
                    title: "å®‰é™çš„åˆå" 
                },
                street: { 
                    img: "åœºæ™¯2.png", 
                    title: "é›¨åçš„è¡—é“" 
                },
                park_day: { 
                    img: "åœºæ™¯3.png", 
                    title: "é˜³å…‰ä¸‹çš„æ¸¸ä¹å›­" 
                },
                park_night: { 
                    img: "åœºæ™¯4.png", 
                    title: "å¤œæ™šçš„æ‘©å¤©è½®" 
                },
                beach: { 
                    img: "åœºæ™¯5.png", 
                    title: "é»„æ˜çš„æµ·æ»©" 
                },
                living_room: { 
                    img: "åœºæ™¯6.png", 
                    title: "æ¸©é¦¨çš„å®¢å…" 
                },
                extra1: { 
                    img: "åœºæ™¯7.png", 
                    title: "æ¨±èŠ±æ ‘ä¸‹" 
                },
                extra2: { 
                    img: "åœºæ™¯8.png", 
                    title: "æ˜Ÿç©ºä¸‹" 
                }
            },

            // ä¸ºæ¯ä¸ªè§’è‰²å®šä¹‰ä¸åŒçš„å‰§æƒ…çº¿
            scripts: {
                // è“å‘å°‘å¥³çš„å‰§æƒ… - æ–‡è‰ºå‘
                1: [
                    {
                        scene: "home",
                        character: 1,
                        text: "å‘¼...ç»ˆäºå®Œæˆäº†è¿™å¹…ã€Šå¤æ—¥çš„è®°å¿†ã€‹ã€‚è°ƒè‰²ç›˜ä¸Šçš„é¢œæ–™å·²ç»å¿«å¹²äº†ï¼Œå°±åƒè¿™ä¸ªå¤å¤©ä¸€æ ·çŸ­æš‚..."
                    },
                    {
                        scene: "street",
                        character: 0,
                        text: "æ”¾ä¸‹ç”»ç¬”ï¼Œæˆ‘å†³å®šå‡ºé—¨èµ°èµ°ã€‚é›¨åçš„ç©ºæ°”å¸¦ç€æ³¥åœŸçš„èŠ¬èŠ³ï¼ŒçŸ³æ¿è·¯ä¸Šè¿˜æ®‹ç•™ç€æ°´è¿¹..."
                    },
                    {
                        scene: "park_day",
                        character: 1,
                        text: "ä½ çŸ¥é“å—ï¼Ÿæˆ‘æ¯æ¬¡ç”»ç”»çš„æ—¶å€™ï¼Œéƒ½ä¼šæƒ³èµ·æˆ‘ä»¬ç¬¬ä¸€æ¬¡åœ¨ç”»å®¤ç›¸é‡çš„åœºæ™¯..."
                    },
                    {
                        scene: "living_room",
                        character: 0,
                        text: "ä½ é€æˆ‘çš„é‚£æœ¬è¯—é›†ï¼Œæˆ‘å·²ç»è¯»äº†ç¬¬ä¸‰éã€‚æ¯ä¸€é¦–è¯—éƒ½åƒåœ¨è®²è¿°æˆ‘ä»¬çš„æ•…äº‹..."
                    },
                    {
                        scene: "beach",
                        character: 1,
                        text: "ç«™åœ¨æµ·è¾¹ï¼Œå¬ç€æ¶›å£°ï¼Œæˆ‘çªç„¶æ˜ç™½â€”â€”æœ‰äº›æ„Ÿæƒ…ï¼Œå°±åƒè¿™æµ·è¾¹çš„è´å£³ï¼Œéœ€è¦æ—¶é—´æ‰èƒ½æ‰¾åˆ°æœ€å®Œç¾çš„é‚£ä¸ª..."
                    },
                    {
                        scene: "extra1",
                        character: 0,
                        text: "æ¨±èŠ±è™½ç„¶å·²ç»å‡‹è°¢ï¼Œä½†æˆ‘ç”¨ç”»ç¬”è®°å½•ä¸‹äº†å®ƒæœ€ç¾çš„ç¬é—´ã€‚å°±åƒæˆ‘ç”¨è®°å¿†è®°å½•ä¸‹æˆ‘ä»¬çš„æ¯ä¸€ä¸ªç¬é—´..."
                    },
                    {
                        scene: "home",
                        character: 1,
                        text: "è¿™å¹…ç”»ï¼Œæˆ‘æƒ³å–åä¸ºã€Šå¤æ—¥çš„çº¦å®šã€‹ã€‚å› ä¸ºå®ƒè§è¯äº†æˆ‘ä»¬çš„ç›¸é‡ï¼Œä¹Ÿæ‰¿è½½ç€æˆ‘çš„æ„Ÿè°¢..."
                    },
                    {
                        scene: "home",
                        character: 0,
                        text: "ï¼ˆç»“å±€ï¼‰ç”»å¸ƒä¸Šçš„è‰²å½©æ¸æ¸èåˆï¼Œå°±åƒæˆ‘ä»¬ä¹‹é—´é‚£äº›è¯´ä¸æ¸…é“ä¸æ˜çš„æƒ…æ„Ÿã€‚è¿™ä¸ªå¤å¤©ï¼Œå› ä¸ºæœ‰ä½ ï¼Œå˜å¾—æ ¼å¤–çè´µã€‚"
                    }
                ],

                // é“¶å‘å°‘å¥³çš„å‰§æƒ… - æ´»åŠ›å‘
                3: [
                    {
                        scene: "park_day",
                        character: 2,
                        text: "è€¶ï¼ä»Šå¤©åˆæ˜¯å……æ»¡æ´»åŠ›çš„ä¸€å¤©ï¼è¦ä¸è¦ä¸€èµ·å»çˆ¬å±±ï¼Ÿæˆ‘çŸ¥é“ä¸€æ¡å¾ˆæ¼‚äº®çš„å°è·¯ï¼"
                    },
                    {
                        scene: "street",
                        character: 0,
                        text: "å¥¹æ€»æ˜¯è¿™æ ·å……æ»¡æ´»åŠ›ï¼Œä»¿ä½›æ°¸è¿œä¸çŸ¥é“ç–²æƒ«ã€‚è·Ÿå¥¹åœ¨ä¸€èµ·ï¼Œæ•´ä¸ªä¸–ç•Œéƒ½å˜å¾—æ˜äº®èµ·æ¥..."
                    },
                    {
                        scene: "beach",
                        character: 2,
                        text: "çœ‹ï¼æˆ‘å‘ç°äº†å¥½å¤§ä¸€ä¸ªè´å£³ï¼é‡Œé¢ä¼šä¸ä¼šæœ‰çç ï¼Ÿå•Šå“ˆå“ˆå“ˆï¼Œå¼€ç©ç¬‘çš„å•¦ï¼"
                    },
                    {
                        scene: "park_day",
                        character: 0,
                        text: "æ—‹è½¬æœ¨é©¬çš„ç¯å…‰åœ¨å¥¹çœ¼ä¸­é—ªçƒï¼Œå¥¹çš„ç¬‘å£°æ¯”éŸ³ä¹è¿˜è¦åŠ¨å¬..."
                    },
                    {
                        scene: "extra1",
                        character: 2,
                        text: "ä½ çŸ¥é“å—ï¼Ÿè¿™æ£µæ ‘æ˜¯é™„è¿‘æœ€è€çš„æ¨±èŠ±æ ‘ã€‚æ˜¥å¤©çš„æ—¶å€™ï¼ŒèŠ±ç“£é£˜è½çš„æ ·å­ç¾æäº†ï¼æ˜å¹´æ˜¥å¤©ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹å§ï¼"
                    },
                    {
                        scene: "park_night",
                        character: 0,
                        text: "å¤œæ™šçš„æ¸¸ä¹å›­æ ¼å¤–å®é™ï¼Œåªæœ‰æˆ‘ä»¬çš„è„šæ­¥å£°å’Œè¿œå¤„çš„è™«é¸£..."
                    },
                    {
                        scene: "beach",
                        character: 2,
                        text: "è°¢è°¢ä½ æ„¿æ„é™ªæˆ‘ä¸€èµ·ç–¯ã€‚å…¶å®...æˆ‘ä¹Ÿæœ‰å®‰é™çš„æ—¶å€™ï¼Œåªæ˜¯å’Œä½ åœ¨ä¸€èµ·ï¼Œæˆ‘å°±å˜å¾—ç‰¹åˆ«å¼€å¿ƒï¼"
                    },
                    {
                        scene: "park_day",
                        character: 0,
                        text: "ï¼ˆç»“å±€ï¼‰å¤ªé˜³æ¸æ¸è½ä¸‹ï¼Œä½†å¥¹çš„ç¬‘å®¹æ°¸è¿œåƒé˜³å…‰ä¸€æ ·æ¸©æš–ã€‚è¿™ä¸ªå……æ»¡æ´»åŠ›çš„å¤å¤©ï¼Œæˆ‘ä¼šæ°¸è¿œè®°ä½ã€‚"
                    }
                ],

                // ç»¿å‘å°‘å¥³çš„å‰§æƒ… - ç¥ç§˜å‘
                2: [
                    {
                        scene: "living_room",
                        character: 3,
                        text: "è¿™é¦–æœˆå…‰å¥é¸£æ›²ï¼Œæ˜¯è´å¤šèŠ¬å†™ç»™æ°¸æ’çš„çˆ±äººçš„ã€‚ä½ å¬ï¼Œæ¯ä¸€ä¸ªéŸ³ç¬¦éƒ½åœ¨è¯‰è¯´ç€æ€å¿µ..."
                    },
                    {
                        scene: "street",
                        character: 0,
                        text: "å¤œæ™šçš„è¡—é“å¾ˆå®‰é™ï¼Œåªæœ‰æˆ‘ä»¬çš„è„šæ­¥å£°å’Œè¿œå¤„éšçº¦ä¼ æ¥çš„é’¢ç´å£°..."
                    },
                    {
                        scene: "extra2",
                        character: 3,
                        text: "çœ‹é‚£é¢—æœ€äº®çš„æ˜Ÿæ˜Ÿï¼Œé‚£æ˜¯å¤©ç´åº§çš„ç»‡å¥³æ˜Ÿã€‚ä¼ è¯´ä¸­ï¼Œå¥¹æ¯å¹´ä¸ƒå¤•éƒ½ä¼šä¸ç‰›éƒç›¸ä¼š..."
                    },
                    {
                        scene: "park_night",
                        character: 0,
                        text: "æ‘©å¤©è½®ç¼“ç¼“å‡èµ·ï¼Œçª—å¤–çš„åŸå¸‚æ¸æ¸å˜å°ï¼Œä»¿ä½›æ•´ä¸ªå®‡å®™éƒ½åœ¨æˆ‘ä»¬è„šä¸‹..."
                    },
                    {
                        scene: "extra2",
                        character: 3,
                        text: "ä½ çŸ¥é“ä¸ºä»€ä¹ˆæ˜Ÿæ˜Ÿä¼šé—ªçƒå—ï¼Ÿå› ä¸ºå®ƒä»¬åœ¨è¯‰è¯´ç€è‡ªå·±çš„æ•…äº‹ï¼Œå°±åƒæˆ‘ä»¬æ¯ä¸ªäººä¸€æ ·..."
                    },
                    {
                        scene: "living_room",
                        character: 0,
                        text: "èŒ¶é¦™åœ¨ç©ºæ°”ä¸­å¼¥æ¼«ï¼ŒéŸ³ä¹åœ¨è€³è¾¹æµæ·Œï¼Œæ—¶é—´ä»¿ä½›åœ¨è¿™ä¸€åˆ»é™æ­¢äº†..."
                    },
                    {
                        scene: "beach",
                        character: 3,
                        text: "æµ·æµªæ˜¯åœ°çƒçš„å‘¼å¸ï¼Œæ˜Ÿç©ºæ˜¯å®‡å®™çš„çœ¼ç›ã€‚è€Œä½ ...æ˜¯æˆ‘åœ¨è¿™ä¸ªå¤å¤©æœ€ç¾çš„é‚‚é€…ã€‚"
                    },
                    {
                        scene: "extra2",
                        character: 0,
                        text: "ï¼ˆç»“å±€ï¼‰æ˜Ÿå…‰æ´’åœ¨å¥¹çš„é“¶å‘ä¸Šï¼Œä»¿ä½›æˆ´ä¸Šäº†ä¸€é¡¶é—ªçƒçš„çš‡å† ã€‚è¿™ä¸ªç¥ç§˜çš„å¤å¤©ï¼Œè®©æˆ‘çœ‹åˆ°äº†ä¸ä¸€æ ·çš„æ˜Ÿç©ºã€‚"
                    }
                ],

                // ç´«å‘å°‘å¥³çš„å‰§æƒ… - æµªæ¼«å‘
                4: [
                    {
                        scene: "park_night",
                        character: 4,
                        text: "å¿«çœ‹ï¼æ‘©å¤©è½®çš„ç¯å…‰äº®èµ·æ¥äº†ï¼åƒä¸åƒä¸€é¢—å·¨å¤§çš„æ˜Ÿæ˜Ÿï¼Ÿæˆ‘ä»¬å»åæœ€é¡¶ä¸Šçš„é‚£ä¸ªåº§èˆ±å§ï¼"
                    },
                    {
                        scene: "park_day",
                        character: 0,
                        text: "æ—‹è½¬æœ¨é©¬çš„éŸ³ä¹å£°åœ¨è€³è¾¹å›å“ï¼Œå¥¹çš„ç¬‘å£°åƒç³–æœä¸€æ ·ç”œç¾..."
                    },
                    {
                        scene: "living_room",
                        character: 4,
                        text: "è¿™æ˜¯æˆ‘äº²æ‰‹åšçš„è‰è“è›‹ç³•ï¼è™½ç„¶è£±èŠ±æœ‰ç‚¹æ­ªï¼Œä½†å‘³é“åº”è¯¥ä¸é”™...è¦å°å°çœ‹å—ï¼Ÿ"
                    },
                    {
                        scene: "extra1",
                        character: 0,
                        text: "è™½ç„¶æ˜¯å¤å¤©ï¼Œä½†ç«™åœ¨æ¨±èŠ±æ ‘ä¸‹ï¼Œä»¿ä½›èƒ½æƒ³è±¡åˆ°æ˜¥å¤©æ—¶èŠ±ç“£é£˜è½çš„æµªæ¼«åœºæ™¯..."
                    },
                    {
                        scene: "park_night",
                        character: 4,
                        text: "ä»è¿™ä¹ˆé«˜çš„åœ°æ–¹çœ‹å¤œæ™¯ï¼Œæ„Ÿè§‰æ•´ä¸ªä¸–ç•Œéƒ½å˜å¾—å¥½å°ã€‚ä½†æœ‰äº›ä¸œè¥¿ï¼Œç¦»å¾—è¶Šè¿‘åè€Œè¶Šçœ‹ä¸æ¸…..."
                    },
                    {
                        scene: "beach",
                        character: 0,
                        text: "æµ·æµªæ‹æ‰“ç€æ²™æ»©ï¼Œå¤•é˜³æŠŠå¤©ç©ºæŸ“æˆäº†ç²‰è‰²ï¼Œå°±åƒå¥¹çš„è„¸é¢Š..."
                    },
                    {
                        scene: "park_day",
                        character: 4,
                        text: "ä½ çŸ¥é“å—ï¼Ÿæ¸¸ä¹å›­çš„ä¼ è¯´â€”â€”å¦‚æœåœ¨æ‘©å¤©è½®åˆ°è¾¾æœ€é«˜ç‚¹æ—¶è®¸æ„¿ï¼Œæ„¿æœ›å°±ä¼šå®ç°..."
                    },
                    {
                        scene: "park_night",
                        character: 0,
                        text: "ï¼ˆç»“å±€ï¼‰æ‘©å¤©è½®è½¬äº†ä¸€åœˆåˆå›åˆ°èµ·ç‚¹ï¼Œä½†æœ‰äº›äº‹æƒ…å·²ç»ä¸ä¸€æ ·äº†ã€‚è¿™ä¸ªç”œèœœçš„å¤å¤©ï¼Œæ˜¯è®°å¿†ä¸­æ°¸ä¸è¤ªè‰²çš„ç²‰çº¢è‰²ã€‚"
                    }
                ]
            }
        };

        // DOMå…ƒç´ 
        const selectionScreen = document.getElementById('selectionScreen');
        const gameScreen = document.getElementById('gameScreen');
        const startButton = document.getElementById('startButton');
        const characterCards = document.querySelectorAll('.character-card');
        
        const sceneImage = document.getElementById('sceneImage');
        const sceneTitle = document.getElementById('sceneTitle');
        const dialogueAvatar = document.getElementById('dialogueAvatar');
        const dialogueName = document.getElementById('dialogueName');
        const dialogueText = document.getElementById('dialogueText');
        const nextButton = document.getElementById('nextButton');
        const restartButton = document.getElementById('restartButton');

        // æ¸¸æˆçŠ¶æ€
        let selectedCharacter = null;
        let currentStep = 0;
        let isFirstClick = true;
        let currentScript = [];

        // è§’è‰²é€‰æ‹©
        characterCards.forEach(card => {
            card.addEventListener('click', function() {
                characterCards.forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                selectedCharacter = this.dataset.id;
            });
        });

        // å¼€å§‹æ•…äº‹
        startButton.addEventListener('click', function() {
            if (!selectedCharacter) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè§’è‰²ï¼');
                return;
            }

            // ğŸµ ç‚¹å‡»å¼€å§‹æ—¶æ’­æ”¾éŸ³ä¹
            if (window.musicController && !window.musicController.isPlaying) {
                window.musicController.playMusic();
            }

            selectionScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            
            currentScript = storyData.scripts[selectedCharacter];
            
            showCurrentDialogue();
        });

        // æ˜¾ç¤ºå½“å‰å¯¹è¯
        function showCurrentDialogue() {
            if (currentStep >= currentScript.length) {
                showEnding();
                return;
            }

            const line = currentScript[currentStep];
            const scene = storyData.scenes[line.scene];
            
            // æ›´æ–°åœºæ™¯
            sceneImage.src = scene.img;
            sceneTitle.textContent = scene.title;
            
            // è®¾ç½®é»˜è®¤å ä½å›¾
            sceneImage.onerror = function() {
                this.src = 'data:image/svg+xml;utf8,<svg width="100%" height="100%" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%" fill="#2c3e50"/><text x="50%" y="50%" text-anchor="middle" fill="white" font-size="20">åœºæ™¯å›¾ç‰‡</text></svg>';
            };

            // æ›´æ–°å¯¹è¯
            if (line.character === 0) {
                dialogueAvatar.style.display = 'none';
                dialogueName.textContent = '';
                dialogueText.innerHTML = `<i>${line.text}</i>`;
            } else {
                dialogueAvatar.style.display = 'block';
                const char = storyData.characters[line.character];
                dialogueAvatar.src = char.img;
                dialogueAvatar.onerror = function() {
                    this.src = 'data:image/svg+xml;utf8,<svg width="100%" height="100%" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="45" fill="#34495e"/><text x="50" y="55" text-anchor="middle" fill="white" font-size="12">å¤´åƒ</text></svg>';
                };
                dialogueName.textContent = char.name;
                dialogueText.textContent = line.text;
            }
            
            if (isFirstClick) {
                nextButton.textContent = "å¼€å§‹å¯¹è¯";
                isFirstClick = false;
            } else {
                nextButton.textContent = "ç»§ç»­";
            }
        }

        // æ˜¾ç¤ºç»“å±€
        function showEnding() {
            const char = storyData.characters[selectedCharacter];
            sceneImage.src = storyData.scenes.home.img;
            sceneTitle.textContent = `${char.name}çš„æ•…äº‹`;
            dialogueAvatar.style.display = 'block';
            dialogueAvatar.src = char.img;
            dialogueName.textContent = "æ•…äº‹ç»“æŸ";
            dialogueText.innerHTML = `<strong>${char.name}çš„æ•…äº‹å·²å®Œç»“</strong><br><br>æ„Ÿè°¢ä½ ä½“éªŒ${char.name}çš„æ•…äº‹ã€‚æ¯ä¸ªè§’è‰²éƒ½æœ‰ä¸åŒçš„ä¸ªæ€§å’Œç»å†ï¼Œè¯•ç€æ¢ç´¢å…¶ä»–è§’è‰²çš„æ•…äº‹çº¿å§ï¼`;
            nextButton.style.display = 'none';
            restartButton.classList.remove('hidden');
        }

        // ä¸‹ä¸€å¥å¯¹è¯
        nextButton.addEventListener('click', function() {
            currentStep++;
            showCurrentDialogue();
        });

        // é‡æ–°å¼€å§‹
        restartButton.addEventListener('click', function() {
            // é‡ç½®çŠ¶æ€
            currentStep = 0;
            selectedCharacter = null;
            isFirstClick = true;
            currentScript = [];
            
            // é‡ç½®UI
            characterCards.forEach(card => card.classList.remove('selected'));
            selectionScreen.style.display = 'block';
            gameScreen.style.display = 'none';
            nextButton.style.display = 'block';
            restartButton.classList.add('hidden');
            
            // é‡ç½®å¯¹è¯æ˜¾ç¤º
            dialogueAvatar.style.display = 'none';
            dialogueName.textContent = '';
            dialogueText.textContent = 'ç‚¹å‡»"å¼€å§‹å¯¹è¯"æŒ‰é’®ç»§ç»­æ•…äº‹...';
        });

        // å›¾ç‰‡åŠ è½½æ£€æµ‹
        function checkImages() {
            const images = [
                '1.png', '2.png', '3.png', '4.png',
                'åœºæ™¯1.jpg', 'åœºæ™¯2.png', 'åœºæ™¯3.png', 'åœºæ™¯4.png',
                'åœºæ™¯5.png', 'åœºæ™¯6.png', 'åœºæ™¯7.png', 'åœºæ™¯8.png'
            ];
            
            images.forEach(img => {
                const testImg = new Image();
                testImg.onload = function() {
                    console.log(`âœ… ${img} åŠ è½½æˆåŠŸ`);
                };
                testImg.onerror = function() {
                    console.warn(`âŒ ${img} åŠ è½½å¤±è´¥ï¼Œå°†ä½¿ç”¨å ä½å›¾`);
                };
                testImg.src = img;
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥å›¾ç‰‡
        window.addEventListener('DOMContentLoaded', checkImages);
    </script>
</body>
</html>